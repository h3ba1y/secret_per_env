name: 'Build and Deploy to dev'

on:
  push:
    branches:
      - develop
      - master
      - qa

jobs:
  call_reuable_code:
    runs-on: ubuntu-latest
    outputs:
      output1: ${{ steps.vars.outputs.git_short_ref }}

    steps:
      - name: "Set github short ref"
        id: vars
        run: |
          echo "GITHUB_REF=${GITHUB_REF}"
          echo "::set-env name=git_short_ref::${GITHUB_REF#refs/*/}"
  deploy-to-env:
    name: "deploy to environment"
    needs: call_reuable_code
    uses: ./.github/workflows/test.yml
    secrets: inherit
    with:
      env: ${{ fromJSON('{develop:"dev",qa:"qa", master:"prod"}')[needs.call_reuable_code.steps.var1.output1] }}
